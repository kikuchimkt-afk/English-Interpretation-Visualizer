<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Visualizer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        .word-container {
            display: inline-flex; flex-direction: column; justify-content: flex-end; position: relative; vertical-align: bottom;
        }
        .word-span {
            padding-top: 0.35rem; padding-bottom: 0.35rem;
            padding-left: 0.2rem; padding-right: 0.4rem; 
            margin: 0; display: inline-block; line-height: 1.5;
            box-decoration-break: clone; -webkit-box-decoration-break: clone;
        }
        .fade-in { animation: fadeIn 0.5s ease-in forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-amber-50 text-slate-900 min-h-screen">
    <div id="root"></div>    <script type="text/babel">
        // ==========================================
        // /* === データ生成セクション (ここをAIが生成) === */
        // ==========================================
        
        const TITLE = "Fun at the Beach (Part 3)";
        const SOURCE_CREDIT = "出典: 英検4級 2024年 第3回 大問4C";

        // 全文 (第3パラグラフ)
        const RAW_SENTENCE = "Last fall, Jill went to college. At college, she started taking surfing lessons. Her first lesson was in the college swimming pool. Now, Jill has a lesson every week. This summer, she will take a trip with her friends. They will go surfing in the sea.";

        // 単語ごとの役割定義
        const WORD_ROLES = [
            // Last fall, Jill went to college.
            'M', 'M', 'S', 'V', 'M', 'M',
            // At college, she started taking surfing lessons.
            'M', 'M', 'S', 'V', 'O', 'O', 'O',
            // Her first lesson was in the college swimming pool.
            'S', 'S', 'S', 'V', 'M', 'M', 'M', 'M', 'M',
            // Now, Jill has a lesson every week.
            'M', 'S', 'V', 'O', 'O', 'M', 'M',
            // This summer, she will take a trip with her friends.
            'M', 'M', 'S', 'V', 'V', 'O', 'O', 'M', 'M', 'M',
            // They will go surfing in the sea.
            'S', 'V', 'V', 'C', 'M', 'M', 'M'
        ];

        const WORDS = RAW_SENTENCE.split(' ').map((word, index) => ({
            id: index, text: word, role: WORD_ROLES[index] || 'OTHER'
        }));

        // 日本語チャンク訳 (直読直解)
        const JP_CHUNKS = [
            // S1
            { ids: [0,1], text: "去年の秋", role: "M" },
            { ids: [2], text: "ジルは", role: "S" },
            { ids: [3], text: "行きました", role: "V" }, // went (入学した)
            { ids: [4,5], text: "大学へ", role: "M" },
            // S2
            { ids: [6,7], text: "大学で", role: "M" },
            { ids: [8], text: "彼女は", role: "S" },
            { ids: [9], text: "始めました", role: "V" },
            { ids: [10,11,12], text: "サーフィンのレッスンを受けることを", role: "O" },
            // S3
            { ids: [13,14,15], text: "彼女の最初のレッスンは", role: "S" },
            { ids: [16], text: "ありました", role: "V" },
            { ids: [17,18,19,20,21], text: "大学のプールで", role: "M" },
            // S4
            { ids: [22], text: "今では", role: "M" },
            { ids: [23], text: "ジルは", role: "S" },
            { ids: [24], text: "受けています（持っています）", role: "V" }, // has
            { ids: [25,26], text: "レッスンを", role: "O" },
            { ids: [27,28], text: "毎週", role: "M" },
            // S5
            { ids: [29,30], text: "この夏", role: "M" },
            { ids: [31], text: "彼女は", role: "S" },
            { ids: [32,33], text: "旅行をするつもりです", role: "V" }, // will take
            { ids: [34,35], text: "旅行を", role: "O" },
            { ids: [36,37,38], text: "友達と一緒に", role: "M" },
            // S6
            { ids: [39], text: "彼らは", role: "S" },
            { ids: [40,41], text: "行くつもりです", role: "V" }, // will go
            { ids: [42], text: "サーフィンをしに", role: "C" },
            { ids: [43,44,45], text: "海へ", role: "M" }
        ];

        // 学習ステップ
        const STEPS = [
            {
                title: "#1 進学 (College)",
                description: "「went to college」で「大学に進学した（入学した）」という意味になります。",
                highlightIds: [0, 1, 2, 3, 4, 5],
                annotations: [
                    { type: 'label', wordId: 0, text: 'いつ' },
                    { type: 'label', wordId: 2, text: 'だれが' },
                    { type: 'label', wordId: 3, text: 'どうする' },
                ]
            },
            {
                title: "#2 新しい趣味 (Start)",
                description: "「taking」は「受けること」という名詞の役割（動名詞）をしています。",
                highlightIds: [6, 7, 8, 9, 10, 11, 12],
                annotations: [
                    { type: 'label', wordId: 8, text: 'だれが' },
                    { type: 'label', wordId: 9, text: 'どうする' },
                    { type: 'label', wordId: 10, text: 'なにを' },
                ]
            },
            {
                title: "#3 最初のレッスン (First Lesson)",
                description: "最初のレッスンは海ではなく、プールで行われました。",
                highlightIds: [13, 14, 15, 16, 17, 18, 19, 20, 21],
                annotations: [
                    { type: 'label', wordId: 15, text: 'だれが' },
                    { type: 'label', wordId: 16, text: 'どうする' },
                    { type: 'label', wordId: 21, text: 'どこで' },
                    { type: 'underline', startId: 17, endId: 21 }
                ]
            },
            {
                title: "#4 現在の習慣 (Routine)",
                description: "「Now」があるので、現在の話に戻ります。「has a lesson」で「レッスンがある/受ける」です。",
                highlightIds: [22, 23, 24, 25, 26, 27, 28],
                annotations: [
                    { type: 'label', wordId: 23, text: 'だれが' },
                    { type: 'label', wordId: 24, text: 'どうする' },
                    { type: 'label', wordId: 26, text: 'なにを' },
                ]
            },
            {
                title: "#5 夏の計画 (Plan)",
                description: "「will」は未来の予定（～するつもり）を表します。「take a trip」で「旅行をする」です。",
                highlightIds: [29, 30, 31, 32, 33, 34, 35, 36, 37, 38],
                annotations: [
                    { type: 'label', wordId: 29, text: 'いつ' },
                    { type: 'label', wordId: 31, text: 'だれが' },
                    { type: 'label', wordId: 33, text: 'どうする' },
                    { type: 'label', wordId: 35, text: 'なにを' },
                ]
            },
            {
                title: "#6 海へ (Goal)",
                description: "ついに海へ行きます！「will go surfing」で「サーフィンをしに行くつもりだ」という意味です。",
                highlightIds: [39, 40, 41, 42, 43, 44, 45],
                annotations: [
                    { type: 'label', wordId: 39, text: 'だれが' },
                    { type: 'label', wordId: 41, text: 'どうする' },
                    { type: 'label', wordId: 42, text: 'なにをしに' },
                    { type: 'label', wordId: 45, text: 'どこへ' },
                ]
            }
        ];

        // ==========================================
        // /* === ロジックセクション (固定・変更禁止) === */
        // ==========================================
        const ROLE_STYLES = {
            S: { color: '#1e40af', bg: '#dbeafe', label: 'S (だれが)' },
            V: { color: '#b91c1c', bg: '#fee2e2', label: 'V (どうする)' },
            O: { color: '#047857', bg: '#d1fae5', label: 'O (なにを)' },
            C: { color: '#047857', bg: '#d1fae5', label: 'C (どんなだ/補語)' },
            M: { color: '#b45309', bg: '#fef3c7', label: 'M (いつ・どこ・修飾)' },
            CONN: { color: '#7e22ce', bg: '#f3e8ff', label: 'CONN (つなぎ)' },
            OTHER: { color: '#334155', bg: 'transparent', label: '' }
        };

        const App = () => {
            const [currentStepIndex, setCurrentStepIndex] = React.useState(0);
            const containerRef = React.useRef(null);
            
            const currentStep = STEPS[currentStepIndex];
            const activeIds = currentStep.highlightIds || [];

            const nextStep = () => {
                if (currentStepIndex < STEPS.length - 1) setCurrentStepIndex(prev => prev + 1);
            };

            const prevStep = () => {
                if (currentStepIndex > 0) setCurrentStepIndex(prev => prev - 1);
            };

            const getActiveJpChunks = () => {
                return JP_CHUNKS.filter(chunk => 
                    chunk.ids.some(id => activeIds.includes(id))
                );
            };

            React.useEffect(() => {
                if (containerRef.current) {
                    const activeElement = containerRef.current.querySelector('[data-active="true"]');
                    if (activeElement) {
                        activeElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }, [currentStepIndex]);

            const getWordStyle = (role, isActive) => {
                const style = ROLE_STYLES[role] || ROLE_STYLES.OTHER;
                if (!isActive) return { color: '#cbd5e1', backgroundColor: 'transparent' };
                return {
                    color: style.color,
                    backgroundColor: style.bg,
                };
            };

            return (
                <div className="max-w-4xl mx-auto p-4 md:p-8 font-sans">
                    <header className="mb-6 flex justify-between items-end border-b border-slate-200 pb-4 sticky top-0 bg-amber-50 z-20">
                        <div>
                            <h1 className="text-xl md:text-2xl font-bold text-slate-800 flex items-center gap-2">
                                <span className="bg-amber-400 text-white px-2 py-1 rounded text-sm">Learning</span>
                                {TITLE}
                            </h1>
                            <p className="text-xs md:text-sm text-slate-500 mt-1">{SOURCE_CREDIT}</p>
                        </div>
                        <div className="text-sm font-semibold text-slate-500 whitespace-nowrap ml-4">
                            Step {currentStepIndex + 1} / {STEPS.length}
                        </div>
                    </header>

                    <main className="bg-white rounded-xl shadow-lg p-6 md:p-10 mb-8 relative overflow-hidden h-[400px] overflow-y-auto" id="text-container">
                        <div className="relative leading-[2.8] text-2xl font-medium flex flex-wrap gap-y-4" ref={containerRef}>
                            {WORDS.map((word, index) => {
                                const isActive = activeIds.includes(word.id);
                                const style = getWordStyle(word.role, isActive);
                                
                                const annotationsForWord = currentStep.annotations ? currentStep.annotations.filter(a => a.wordId === word.id) : [];
                                const labelAnnotation = annotationsForWord.find(a => a.type === 'label');
                                const label = (isActive && labelAnnotation) ? labelAnnotation.text : null;
                                const isUnderlined = isActive && currentStep.annotations && currentStep.annotations.some(a => a.type === 'underline' && word.id >= a.startId && word.id <= a.endId);

                                const isPrevActive = activeIds.includes(index - 1);
                                const isNextActive = activeIds.includes(index + 1);
                                const isPrevSameRole = index > 0 && WORDS[index - 1].role === word.role;
                                const isNextSameRole = index < WORDS.length - 1 && WORDS[index + 1].role === word.role;

                                const connectLeft = isActive && isPrevActive && isPrevSameRole;
                                const connectRight = isActive && isNextActive && isNextSameRole;

                                let radiusClasses = "rounded-lg";

                                if (isActive) {
                                    if (connectLeft && connectRight) {
                                        radiusClasses = "rounded-none";
                                    } else if (connectLeft) {
                                        radiusClasses = "rounded-r-lg rounded-l-none";
                                    } else if (connectRight) {
                                        radiusClasses = "rounded-l-lg rounded-r-none";
                                    }
                                }

                                return (
                                    <div 
                                        key={word.id} 
                                        className="word-container group"
                                        data-active={isActive}
                                    >
                                        {label && (
                                            <span 
                                                className="absolute -top-6 left-1/2 transform -translate-x-1/2 text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm whitespace-nowrap z-30 fade-in"
                                                style={{ backgroundColor: style.backgroundColor !== 'transparent' ? ROLE_STYLES[word.role]?.color : '#64748b', color: 'white' }}
                                            >
                                                {label}
                                            </span>
                                        )}
                                        <span 
                                            className={`word-span transition-all duration-300 ${isActive ? 'z-10 font-bold' : 'opacity-40 grayscale'} ${radiusClasses}`}
                                            style={style}
                                        >
                                            {word.text}
                                        </span>
                                        {isUnderlined && (
                                            <div className="absolute bottom-1 left-0 right-0 h-0.5 bg-slate-400 opacity-50 fade-in"></div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </main>

                    <section className="grid md:grid-cols-3 gap-6">
                        <div className="md:col-span-1 space-y-4">
                            <div className="flex gap-2">
                                <button 
                                    onClick={prevStep} 
                                    disabled={currentStepIndex === 0}
                                    className="flex-1 px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-600 font-semibold hover:bg-slate-50 disabled:opacity-50 transition shadow-sm"
                                >
                                    ← 戻る
                                </button>
                                <button 
                                    onClick={nextStep} 
                                    disabled={currentStepIndex === STEPS.length - 1}
                                    className="flex-1 px-4 py-3 bg-indigo-600 rounded-lg text-white font-semibold hover:bg-indigo-700 disabled:opacity-50 shadow-md transition"
                                >
                                    次へ →
                                </button>
                            </div>
                            
                            <div className="bg-white p-5 rounded-lg border border-slate-200 shadow-sm" key={currentStepIndex}>
                                <h3 className="font-bold text-lg text-indigo-900 mb-2">{currentStep.title}</h3>
                                <p className="text-slate-600 text-sm leading-relaxed">
                                    {currentStep.description}
                                </p>
                            </div>
                        </div>

                        <div className="md:col-span-2 bg-white p-5 rounded-lg border border-slate-200 shadow-sm min-h-[160px]">
                            <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">語順で理解する (直読直解)</h4>
                            <div className="flex flex-wrap gap-2 text-lg items-end">
                                {getActiveJpChunks().length > 0 ? (
                                    getActiveJpChunks().map((chunk, i) => (
                                        <div key={i} className="flex flex-col items-center fade-in" style={{ animationDelay: `${i * 0.05}s` }}>
                                            <span 
                                                className="px-3 py-1 rounded text-slate-800 font-medium border-b-2 text-base md:text-lg"
                                                style={{ 
                                                    backgroundColor: ROLE_STYLES[chunk.role]?.bg || '#f1f5f9',
                                                    borderColor: ROLE_STYLES[chunk.role]?.color || '#cbd5e1'
                                                }}
                                            >
                                                {chunk.text}
                                            </span>
                                            <span className="text-[10px] font-bold mt-1 text-slate-400">
                                                {ROLE_STYLES[chunk.role]?.label || ''}
                                            </span>
                                        </div>
                                    ))
                                ) : (
                                    <p className="text-slate-400 italic opacity-50 transition-opacity duration-300">
                                        ...
                                    </p>
                                )}
                            </div>
                        </div>
                    </section>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>