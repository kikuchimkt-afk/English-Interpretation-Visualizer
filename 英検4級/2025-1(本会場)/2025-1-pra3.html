<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Visualizer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        .word-container {
            display: inline-flex; flex-direction: column; justify-content: flex-end; position: relative; vertical-align: bottom;
        }
        .word-span {
            padding-top: 0.35rem; padding-bottom: 0.35rem;
            padding-left: 0.2rem; padding-right: 0.4rem; 
            margin: 0; display: inline-block; line-height: 1.5;
            box-decoration-break: clone; -webkit-box-decoration-break: clone;
        }
        .fade-in { animation: fadeIn 0.5s ease-in forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-amber-50 text-slate-900 min-h-screen">
    <div id="root"></div>    <script type="text/babel">
        // ==========================================
        // /* === データ生成セクション (ここをAIが生成) === */
        // ==========================================
        
        const TITLE = "An Artist’s Dream (Part 3)";
        const SOURCE_CREDIT = "出典: 英検4級 2025年第1回 大問4C";

        // 第3パラグラフ
        const RAW_SENTENCE = "The teachers needed four weeks to choose a winner. In the end, Daniel won the contest! When he told his parents, they were surprised but very happy. His father said, “Because you love art, you can take art lessons.” Daniel was excited to begin taking art lessons. Now, he takes two art lessons a week.";

        // 単語データ定義
        const WORDS_DATA = [
            // The teachers needed four weeks to choose a winner.
            { t: "The", r: "S" }, { t: "teachers", r: "S" },
            { t: "needed", r: "V" },
            { t: "four", r: "O" }, { t: "weeks", r: "O" },
            { t: "to", r: "M" }, { t: "choose", r: "M" }, { t: "a", r: "M" }, { t: "winner.", r: "M" }, // to choose a winner

            // In the end, Daniel won the contest!
            { t: "In", r: "M" }, { t: "the", r: "M" }, { t: "end,", r: "M" },
            { t: "Daniel", r: "S" },
            { t: "won", r: "V" },
            { t: "the", r: "O" }, { t: "contest!", r: "O" },

            // When he told his parents, they were surprised but very happy.
            { t: "When", r: "CONN" },
            { t: "he", r: "S" },
            { t: "told", r: "V" },
            { t: "his", r: "O" }, { t: "parents,", r: "O" },
            { t: "they", r: "S" },
            { t: "were", r: "V" },
            { t: "surprised", r: "C" },
            { t: "but", r: "CONN" },
            { t: "very", r: "C" }, { t: "happy.", r: "C" },

            // His father said, “Because you love art, you can take art lessons.”
            { t: "His", r: "S" }, { t: "father", r: "S" },
            { t: "said,", r: "V" },
            { t: "“Because", r: "CONN" },
            { t: "you", r: "S" },
            { t: "love", r: "V" },
            { t: "art,", r: "O" },
            { t: "you", r: "S" },
            { t: "can", r: "V" }, { t: "take", r: "V" }, // can take
            { t: "art", r: "O" }, { t: "lessons.”", r: "O" },

            // Daniel was excited to begin taking art lessons.
            { t: "Daniel", r: "S" },
            { t: "was", r: "V" },
            { t: "excited", r: "C" },
            { t: "to", r: "M" }, { t: "begin", r: "M" }, { t: "taking", r: "M" }, { t: "art", r: "M" }, { t: "lessons.", r: "M" },

            // Now, he takes two art lessons a week.
            { t: "Now,", r: "M" },
            { t: "he", r: "S" },
            { t: "takes", r: "V" },
            { t: "two", r: "O" }, { t: "art", r: "O" }, { t: "lessons", r: "O" },
            { t: "a", r: "M" }, { t: "week.", r: "M" }
        ];

        const WORDS = WORDS_DATA.map((item, index) => ({
            id: index, text: item.t, role: item.r
        }));

        // 日本語チャンク訳 (直読直解)
        const JP_CHUNKS = [
            // Sentence 1
            { ids: [0,1], text: "先生たちは", role: "S" },
            { ids: [2], text: "必要でした", role: "V" },
            { ids: [3,4], text: "4週間が", role: "O" },
            { ids: [5,6,7,8], text: "勝者を選ぶために", role: "M" },
            
            // Sentence 2
            { ids: [9,10,11], text: "ついに", role: "M" }, // In the end
            { ids: [12], text: "ダニエルは", role: "S" },
            { ids: [13], text: "勝ち取りました", role: "V" },
            { ids: [14,15], text: "コンテストに！", role: "O" },
            
            // Sentence 3
            { ids: [16], text: "～したとき", role: "CONN" },
            { ids: [17], text: "彼は", role: "S" },
            { ids: [18], text: "伝えました", role: "V" },
            { ids: [19,20], text: "両親に", role: "O" },
            { ids: [21], text: "彼らは", role: "S" },
            { ids: [22], text: "でした", role: "V" },
            { ids: [23], text: "驚いて", role: "C" },
            { ids: [24], text: "しかし", role: "CONN" },
            { ids: [25,26], text: "とても幸せそう", role: "C" },

            // Sentence 4
            { ids: [27,28], text: "彼のお父さんは", role: "S" },
            { ids: [29], text: "言いました", role: "V" },
            { ids: [30], text: "「なぜなら", role: "CONN" },
            { ids: [31], text: "あなたは", role: "S" },
            { ids: [32], text: "愛している", role: "V" },
            { ids: [33], text: "芸術を", role: "O" },
            { ids: [34], text: "あなたは", role: "S" },
            { ids: [35,36], text: "受けてもいいよ", role: "V" },
            { ids: [37,38], text: "芸術のレッスンを」", role: "O" },

            // Sentence 5
            { ids: [39], text: "ダニエルは", role: "S" },
            { ids: [40], text: "でした", role: "V" },
            { ids: [41], text: "興奮して", role: "C" },
            { ids: [42,43,44,45,46], text: "芸術のレッスンを受け始めることに", role: "M" }, // to begin taking...

            // Sentence 6
            { ids: [47], text: "今では", role: "M" },
            { ids: [48], text: "彼は", role: "S" },
            { ids: [49], text: "受けています", role: "V" },
            { ids: [50,51,52], text: "2つの芸術レッスンを", role: "O" },
            { ids: [53,54], text: "週に", role: "M" }
        ];

        // 学習ステップ
        const STEPS = [
            {
                title: "#1 審査期間",
                description: "先生たちは勝者を選ぶのに4週間必要でした。",
                highlightIds: [0, 1, 2, 3, 4, 5, 6, 7, 8],
                annotations: [
                    { type: 'label', wordId: 1, text: 'だれが' },
                    { type: 'label', wordId: 2, text: 'どうする' },
                    { type: 'label', wordId: 4, text: 'なにを' },
                    { type: 'underline', startId: 5, endId: 8 } // to choose a winner
                ]
            },
            {
                title: "#2 結果",
                description: "ついに、ダニエルがコンテストで優勝しました！",
                highlightIds: [9, 10, 11, 12, 13, 14, 15],
                annotations: [
                    { type: 'label', wordId: 12, text: 'だれが' },
                    { type: 'label', wordId: 13, text: 'どうする' },
                    { type: 'label', wordId: 15, text: 'なにを' }
                ]
            },
            {
                title: "#3 報告",
                description: "両親に伝えたとき、彼らは驚きましたがとても喜びました。",
                highlightIds: [16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26],
                annotations: [
                    { type: 'label', wordId: 16, text: 'つなぎ' },
                    { type: 'label', wordId: 17, text: 'だれが' },
                    { type: 'label', wordId: 18, text: 'どうする' },
                    { type: 'label', wordId: 20, text: 'だれに' },
                    { type: 'label', wordId: 21, text: 'だれが' },
                    { type: 'label', wordId: 23, text: 'どんなだ' },
                    { type: 'label', wordId: 26, text: 'どんなだ' }
                ]
            },
            {
                title: "#4 父の言葉",
                description: "お父さんは「芸術が大好きだから、レッスンを受けてもいいよ」と言いました。",
                highlightIds: [27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38],
                annotations: [
                    { type: 'label', wordId: 28, text: 'だれが' },
                    { type: 'label', wordId: 29, text: 'どうする' },
                    { type: 'label', wordId: 30, text: 'つなぎ' },
                    { type: 'label', wordId: 31, text: 'だれが' },
                    { type: 'label', wordId: 32, text: 'どうする' },
                    { type: 'label', wordId: 34, text: 'だれが' },
                    { type: 'label', wordId: 36, text: 'どうする' }
                ]
            },
            {
                title: "#5 新しいスタート",
                description: "ダニエルはレッスンを始めることにワクワクし、今は週に2回通っています。",
                highlightIds: [39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
                annotations: [
                    { type: 'label', wordId: 39, text: 'だれが' },
                    { type: 'label', wordId: 41, text: 'どんなだ' },
                    { type: 'underline', startId: 42, endId: 46 }, // to begin taking art lessons
                    { type: 'label', wordId: 48, text: 'だれが' },
                    { type: 'label', wordId: 49, text: 'どうする' },
                    { type: 'label', wordId: 52, text: 'なにを' }
                ]
            }
        ];

        // ==========================================
        // /* === ロジックセクション (固定・変更禁止) === */
        // ==========================================
        const ROLE_STYLES = {
            S: { color: '#1e40af', bg: '#dbeafe', label: 'S (だれが)' },
            V: { color: '#b91c1c', bg: '#fee2e2', label: 'V (どうする)' },
            O: { color: '#047857', bg: '#d1fae5', label: 'O (なにを)' },
            C: { color: '#047857', bg: '#d1fae5', label: 'C (どんなだ)' },
            M: { color: '#b45309', bg: '#fef3c7', label: 'M (いつ・どこ)' },
            CONN: { color: '#7e22ce', bg: '#f3e8ff', label: 'CONN (つなぎ)' },
            OTHER: { color: '#334155', bg: 'transparent', label: '' }
        };

        const App = () => {
            const [currentStepIndex, setCurrentStepIndex] = React.useState(0);
            const containerRef = React.useRef(null);
            
            const currentStep = STEPS[currentStepIndex];
            const activeIds = currentStep.highlightIds || [];

            const nextStep = () => {
                if (currentStepIndex < STEPS.length - 1) setCurrentStepIndex(prev => prev + 1);
            };

            const prevStep = () => {
                if (currentStepIndex > 0) setCurrentStepIndex(prev => prev - 1);
            };

            const getActiveJpChunks = () => {
                return JP_CHUNKS.filter(chunk => 
                    chunk.ids.some(id => activeIds.includes(id))
                );
            };

            React.useEffect(() => {
                if (containerRef.current) {
                    const activeElement = containerRef.current.querySelector('[data-active="true"]');
                    if (activeElement) {
                        activeElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }, [currentStepIndex]);

            const getWordStyle = (role, isActive) => {
                const style = ROLE_STYLES[role] || ROLE_STYLES.OTHER;
                if (!isActive) return { color: '#cbd5e1', backgroundColor: 'transparent' };
                return {
                    color: style.color,
                    backgroundColor: style.bg,
                };
            };

            return (
                <div className="max-w-4xl mx-auto p-4 md:p-8 font-sans">
                    <header className="mb-6 flex justify-between items-end border-b border-slate-200 pb-4 sticky top-0 bg-amber-50 z-20">
                        <div>
                            <h1 className="text-xl md:text-2xl font-bold text-slate-800 flex items-center gap-2">
                                <span className="bg-amber-400 text-white px-2 py-1 rounded text-sm">Learning</span>
                                {TITLE}
                            </h1>
                            <p className="text-xs md:text-sm text-slate-500 mt-1">{SOURCE_CREDIT}</p>
                        </div>
                        <div className="text-sm font-semibold text-slate-500 whitespace-nowrap ml-4">
                            Step {currentStepIndex + 1} / {STEPS.length}
                        </div>
                    </header>

                    <main className="bg-white rounded-xl shadow-lg p-6 md:p-10 mb-8 relative overflow-hidden h-[400px] overflow-y-auto" id="text-container">
                        <div className="relative leading-[2.8] text-2xl font-medium flex flex-wrap gap-y-4" ref={containerRef}>
                            {WORDS.map((word, index) => {
                                const isActive = activeIds.includes(word.id);
                                const style = getWordStyle(word.role, isActive);
                                
                                const annotationsForWord = currentStep.annotations ? currentStep.annotations.filter(a => a.wordId === word.id) : [];
                                const labelAnnotation = annotationsForWord.find(a => a.type === 'label');
                                const label = (isActive && labelAnnotation) ? labelAnnotation.text : null;
                                const isUnderlined = isActive && currentStep.annotations && currentStep.annotations.some(a => a.type === 'underline' && word.id >= a.startId && word.id <= a.endId);

                                const isPrevActive = activeIds.includes(index - 1);
                                const isNextActive = activeIds.includes(index + 1);
                                const isPrevSameRole = index > 0 && WORDS[index - 1].role === word.role;
                                const isNextSameRole = index < WORDS.length - 1 && WORDS[index + 1].role === word.role;

                                const connectLeft = isActive && isPrevActive && isPrevSameRole;
                                const connectRight = isActive && isNextActive && isNextSameRole;

                                let radiusClasses = "rounded-lg";

                                if (isActive) {
                                    if (connectLeft && connectRight) {
                                        radiusClasses = "rounded-none";
                                    } else if (connectLeft) {
                                        radiusClasses = "rounded-r-lg rounded-l-none";
                                    } else if (connectRight) {
                                        radiusClasses = "rounded-l-lg rounded-r-none";
                                    }
                                }

                                return (
                                    <div 
                                        key={word.id} 
                                        className="word-container group"
                                        data-active={isActive}
                                    >
                                        {label && (
                                            <span 
                                                className="absolute -top-6 left-1/2 transform -translate-x-1/2 text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm whitespace-nowrap z-30 fade-in"
                                                style={{ backgroundColor: style.backgroundColor !== 'transparent' ? ROLE_STYLES[word.role]?.color : '#64748b', color: 'white' }}
                                            >
                                                {label}
                                            </span>
                                        )}
                                        <span 
                                            className={`word-span transition-all duration-300 ${isActive ? 'z-10 font-bold' : 'opacity-40 grayscale'} ${radiusClasses}`}
                                            style={style}
                                        >
                                            {word.text}
                                        </span>
                                        {isUnderlined && (
                                            <div className="absolute bottom-1 left-0 right-0 h-0.5 bg-slate-400 opacity-50 fade-in"></div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </main>

                    <section className="grid md:grid-cols-3 gap-6">
                        <div className="md:col-span-1 space-y-4">
                            <div className="flex gap-2">
                                <button 
                                    onClick={prevStep} 
                                    disabled={currentStepIndex === 0}
                                    className="flex-1 px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-600 font-semibold hover:bg-slate-50 disabled:opacity-50 transition shadow-sm"
                                >
                                    ← 戻る
                                </button>
                                <button 
                                    onClick={nextStep} 
                                    disabled={currentStepIndex === STEPS.length - 1}
                                    className="flex-1 px-4 py-3 bg-indigo-600 rounded-lg text-white font-semibold hover:bg-indigo-700 disabled:opacity-50 shadow-md transition"
                                >
                                    次へ →
                                </button>
                            </div>
                            
                            <div className="bg-white p-5 rounded-lg border border-slate-200 shadow-sm" key={currentStepIndex}>
                                <h3 className="font-bold text-lg text-indigo-900 mb-2">{currentStep.title}</h3>
                                <p className="text-slate-600 text-sm leading-relaxed">
                                    {currentStep.description}
                                </p>
                            </div>
                        </div>

                        <div className="md:col-span-2 bg-white p-5 rounded-lg border border-slate-200 shadow-sm min-h-[160px]">
                            <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">語順で理解する (直読直解)</h4>
                            <div className="flex flex-wrap gap-2 text-lg items-end">
                                {getActiveJpChunks().length > 0 ? (
                                    getActiveJpChunks().map((chunk, i) => (
                                        <div key={i} className="flex flex-col items-center fade-in" style={{ animationDelay: `${i * 0.05}s` }}>
                                            <span 
                                                className="px-3 py-1 rounded text-slate-800 font-medium border-b-2 text-base md:text-lg"
                                                style={{ 
                                                    backgroundColor: ROLE_STYLES[chunk.role]?.bg || '#f1f5f9',
                                                    borderColor: ROLE_STYLES[chunk.role]?.color || '#cbd5e1'
                                                }}
                                            >
                                                {chunk.text}
                                            </span>
                                            <span className="text-[10px] font-bold mt-1 text-slate-400">
                                                {ROLE_STYLES[chunk.role]?.label || ''}
                                            </span>
                                        </div>
                                    ))
                                ) : (
                                    <p className="text-slate-400 italic opacity-50 transition-opacity duration-300">
                                        ...
                                    </p>
                                )}
                            </div>
                        </div>
                    </section>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>